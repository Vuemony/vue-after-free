# توثيق التغييرات على مشروع vue-after-free

## المقدمة

تم تعديل مشروع `vue-after-free` لتلبية متطلبات المستخدم المتعلقة بتحميل GoldHEN. تهدف هذه التعديلات إلى استخدام ملف `goldhen.bin` الموجود مسبقًا في مسار المشروع `src/download0/payloads`، بالإضافة إلى توفير آلية لتحديث GoldHEN عبر فلاشة USB تحتوي على ملف `payload.bin`.

## التغييرات التي تم إجراؤها

تم إجراء التعديلات بشكل أساسي على الملف `src/download0/binloader.ts` لضمان التوافق الكامل مع بيئة PS4.

### 1. حل مشكلة المسارات (Path Resolution)
تمت إضافة منطق ذكي للتعامل مع المسارات التي تبدأ بـ `/download0/`. في بيئة PS4 الحقيقية، قد لا يكون هذا المسار متاحاً مباشرة، لذا يقوم الكود الآن بمحاولة الوصول للملف عبر المسار الكامل المتوقع في الـ Sandbox:
`/mnt/sandbox/download/CUSA00960/download0/payloads/goldhen.bin`

### 2. إضافة مسار GoldHEN الداخلي والنسخ الاحتياطي
تمت إضافة ثابت جديد باسم `INTERNAL_GOLDHEN_PATH` لتحديد المسار الافتراضي لملف `goldhen.bin` داخل المشروع. كما تم تفعيل النسخ التلقائي إلى `/data/payload.bin` لضمان عمل الأدوات الأخرى التي تعتمد على هذا المسار.

### 3. تعديل منطق تحميل الـ Payload في `bin_loader_main`
تم إعادة هيكلة دالة `bin_loader_main` لتطبيق نظام أولوية جديد وأكثر مرونة:

*   **الأولوية 1: تحديث GoldHEN عبر USB**:
    *   البحث عن `payload.bin` في فلاشات USB.
    *   في حال العثور عليه، يتم تحديث الملف الداخلي ونسخه أيضاً إلى `/data/payload.bin`.
    *   يتم تحميل الـ payload من الـ USB مباشرة لضمان السرعة.

*   **الأولوية 2: تحميل GoldHEN الداخلي (مع نسخ صامت)**:
    *   البحث عن `goldhen.bin` في مسار المشروع.
    *   يتم نسخه **بصمت** إلى `/data/payload.bin` بدون إشعارات.
    *   يتم تحميله من مسار المشروع.

*   **الأولوية 3: التحميل من `/data/payload.bin` (خيار احتياطي)**:
    *   إذا لم يوجد الملف في USB أو في المشروع، يتم محاولة تحميله من المسار التقليدي `/data/payload.bin`.

*   **الأولوية 4: العودة إلى محمل الشبكة (Network Loader)**:
    *   كخيار أخير في حال فشل كل ما سبق.

## كيفية الاستخدام

*   **لاستخدام GoldHEN الموجود مسبقًا**: تأكد من وجود ملف `goldhen.bin` في المسار `src/download0/payloads` داخل المشروع المترجم.
*   **لتحديث GoldHEN**: ضع ملف `payload.bin` (الذي يحتوي على GoldHEN المحدث) في فلاشة USB وقم بتوصيلها بالجهاز. سيقوم النظام تلقائيًا باكتشاف الملف، ونسخه إلى المسار الداخلي، ثم تحميله.

## قيود وملاحظات

*   تم إجراء التعديلات على الكود المصدري. يتطلب الأمر الآن إعادة بناء (build) للمشروع بالكامل لكي تصبح هذه التغييرات سارية المفعول.
*   لم يتم إجراء اختبارات وظيفية شاملة لهذه التغييرات في بيئة تشغيل فعلية، وذلك بسبب طبيعة بيئة Sandbox الحالية التي لا تسمح بتشغيل المشروع بالكامل. يوصى بشدة بإجراء اختبارات شاملة بعد بناء المشروع.
*   واجهت عملية التحقق من بناء الكود (TypeScript compilation) بعض الأخطاء المتعلقة بمتغيرات `log` و `is_jailbroken`، والتي يبدو أنها معرفة في سياق أوسع للمشروع. هذه الأخطاء لا تمنع التعديلات المنطقية من العمل ولكنها تشير إلى أن التحقق الكامل يتطلب بيئة بناء متكاملة.

## المراجع

لا توجد مراجع خارجية لهذا التوثيق.
